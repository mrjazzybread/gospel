(ocamllex
 (modules cloc))

(include_subdirs unqualified)

; Creates an executable that type checks the Gospel and OCaml standard
; library and creates a marshalled representation of their
; definitions.

(executable
 (name checklib)
 (libraries gospel)
 (modules_without_implementation gospelstdlib ocamlprimitives))

; Type check the Gospel and OCaml standard library.

(rule
 (targets gospelstdlib.gospel ocamlprimitives.gospel)
 (deps
  (:check checklib.exe)
  (source_tree stdlib))
 (action
  (run %{check})))

(executable
 (name cli)
 (public_name gospel)
 (modules_without_implementation gospelstdlib ocamlprimitives)
 (preprocess
  (pps ppx_blob))
 (preprocessor_deps
  (file gospelstdlib.gospel)
  (file ocamlprimitives.gospel))
 (libraries cmdliner dune-build-info gospel ppx_blob))
